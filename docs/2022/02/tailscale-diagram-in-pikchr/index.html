<!DOCTYPE html>
<html><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Zellyn&#39;s Website">
    
    <link rel="shortcut icon" href="http://localhost:1313/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.min.css">

    <title>Tailscale diagram in Pikchr</title>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script>
      MathJax = {
        tex: {
          displayMath: [['\\[', '\\]'], ['$$', '$$']],  
          inlineMath: [['\\(', '\\)']]                  
        }
      };
    </script>

    
</head>
<body><header id="banner">
    <h2><a href="http://localhost:1313/">Zellyn Hunter</a></h2>
    <nav>
        <ul>
            <li>
                <a href="/page/projects/todo" title="projects">projects</a>
            </li><li>
                <a href="/about/" title="about">about</a>
            </li>
        </ul>
    </nav>
</header>
<main id="content">
<article>
    <header id="post-header">
        <h1>Tailscale diagram in Pikchr</h1>
            <div>
                <time>February 7, 2022</time>
                </div>
    </header><p>Just for fun, I decided to try to use <a href="https://pikchr.org">Pikchr</a> to
reproduce one of the diagrams in Tailscale&rsquo;s <a href="https://tailscale.com/blog/how-nat-traversal-works/">How NAT traversal
works</a> article,
which often receive praise.</p>
<p>Pikchr is not intended for this kind of diagram:</p>
<blockquote>
<p>Pikchr is not intended as a replacement for point-and-click diagrams
creation software. Pikchr is to point-and-click systems as Markdown
is to MS-Word or Google-Docs. Point-and-click interfaces have their
place. But so do text-based systems such as Markdown and Pikchr.<br/>
    &mdash; <a href="https://pikchr.org/home/doc/trunk/doc/purpose.md">The Intended Scope And Purpose Of Pikchr</a></p>
</blockquote>
<p>And indeed, reproducing the diagram took me hours, whereas I could
have reproduced it in a point-and-click diagram editor in 10 or 15
minutes. The diagrams I made about <a href="../cs-ramble/1b/">memory and
variables</a> are a better example of the kind of thing
you can whip up quickly while writing.</p>
<p>Still, it was fun, and hopefully instructive, and those diagrams
really are great.</p>
<!-- make the image wider than the usual 600px in this theme -->
<div style='width:700px;padding:auto;position:relative;left:-75px'>
<div id='pikchr-0' class='pikchr' onclick="toggleHidden('pikchr-0')">
<div class='pikchr-svg' style='max-width:2913px'>
<svg xmlns='http://www.w3.org/2000/svg' viewBox="0 0 2913.12 1547.28">
<path d="M30,789L722,789A28 28 0 0 0 750 760L750,371A28 28 0 0 0 722 342L30,342A28 28 0 0 0 2 371L2,760A28 28 0 0 0 30 789Z"  style="fill:rgb(249,249,248);" />
<path d="M254,637L340,637A28 28 0 0 0 369 609L369,522A28 28 0 0 0 340 493L254,493A28 28 0 0 0 225 522L225,609A28 28 0 0 0 254 637Z"  style="fill:rgb(52,52,51);" />
<path d="M271,619A23 23 0 0 0 295 596L295,535A23 23 0 0 0 271 511A23 23 0 0 0 247 535L247,596A23 23 0 0 0 271 619Z"  style="fill:rgb(214,214,214);" />
<path d="M265,539L294,539L294,511L265,511Z"  style="fill:rgb(214,214,214);" />
<text x="297" y="449" text-anchor="middle" fill="rgb(89,88,87)" font-size="300%" dominant-baseline="central">VPN Client</text>
<text x="297" y="729" text-anchor="middle" fill="rgb(3,3,3)" font-size="300%" dominant-baseline="central">Workstation</text>
<path d="M30,1545L563,1545A28 28 0 0 0 592 1516L592,1127A28 28 0 0 0 563 1098L30,1098A28 28 0 0 0 2 1127L2,1516A28 28 0 0 0 30 1545Z"  style="fill:rgb(249,249,248);" />
<path d="M676,1545L733,1545A28 28 0 0 0 762 1516L762,1127A28 28 0 0 0 733 1098L676,1098A28 28 0 0 0 647 1127L647,1516A28 28 0 0 0 676 1545Z"  style="fill:rgb(249,249,248);" />
<path d="M254,1393L340,1393A28 28 0 0 0 369 1365L369,1278A28 28 0 0 0 340 1249L254,1249A28 28 0 0 0 225 1278L225,1365A28 28 0 0 0 254 1393Z"  style="fill:rgb(52,52,51);" />
<path d="M271,1375A23 23 0 0 0 295 1352L295,1291A23 23 0 0 0 271 1267A23 23 0 0 0 247 1291L247,1352A23 23 0 0 0 271 1375Z"  style="fill:rgb(214,214,214);" />
<path d="M265,1296L294,1296L294,1267L265,1267Z"  style="fill:rgb(214,214,214);" />
<text x="297" y="1205" text-anchor="middle" fill="rgb(89,88,87)" font-size="300%" dominant-baseline="central">VPN Client</text>
<text x="297" y="1485" text-anchor="middle" fill="rgb(3,3,3)" font-size="300%" dominant-baseline="central">Workstation</text>
<path d="M1089,1275L1895,1275A28 28 0 0 0 1924 1246L1924,547A28 28 0 0 0 1895 519L1089,519A28 28 0 0 0 1060 547L1060,1246A28 28 0 0 0 1089 1275Z"  style="fill:rgb(249,249,248);" />
<path d="M1449,983L1535,983A28 28 0 0 0 1564 954L1564,868A28 28 0 0 0 1535 839L1449,839A28 28 0 0 0 1420 868L1420,954A28 28 0 0 0 1449 983Z"  style="fill:rgb(52,52,51);" />
<path d="M1466,965A23 23 0 0 0 1490 941L1490,881A23 23 0 0 0 1466 857A23 23 0 0 0 1442 881L1442,941A23 23 0 0 0 1466 965Z"  style="fill:rgb(214,214,214);" />
<path d="M1460,885L1489,885L1489,856L1460,856Z"  style="fill:rgb(214,214,214);" />
<text x="1492" y="794" text-anchor="middle" fill="rgb(89,88,87)" font-size="300%" dominant-baseline="central">VPN Hub</text>
<text x="1492" y="1187" text-anchor="middle" fill="rgb(3,3,3)" font-size="300%" dominant-baseline="central">Server</text>
<path d="M2349,1134L2882,1134A28 28 0 0 0 2910 1105L2910,717A28 28 0 0 0 2882 688L2349,688A28 28 0 0 0 2320 717L2320,1105A28 28 0 0 0 2349 1134Z"  style="fill:rgb(249,249,248);" />
<path d="M2179,1134L2237,1134A28 28 0 0 0 2265 1105L2265,717A28 28 0 0 0 2237 688L2179,688A28 28 0 0 0 2150 717L2150,1105A28 28 0 0 0 2179 1134Z"  style="fill:rgb(249,249,248);" />
<path d="M2572,983L2658,983A28 28 0 0 0 2687 954L2687,868A28 28 0 0 0 2658 839L2572,839A28 28 0 0 0 2543 868L2543,954A28 28 0 0 0 2572 983Z"  style="fill:rgb(52,52,51);" />
<path d="M2589,965A23 23 0 0 0 2613 941L2613,881A23 23 0 0 0 2589 857A23 23 0 0 0 2566 881L2566,941A23 23 0 0 0 2589 965Z"  style="fill:rgb(214,214,214);" />
<path d="M2584,885L2612,885L2612,856L2584,856Z"  style="fill:rgb(214,214,214);" />
<text x="2615" y="794" text-anchor="middle" fill="rgb(89,88,87)" font-size="300%" dominant-baseline="central">VPN Client</text>
<text x="2615" y="1074" text-anchor="middle" fill="rgb(3,3,3)" font-size="300%" dominant-baseline="central">EC2 VM</text>
<path d="M703,789L812,789L812,342L703,342Z"  style="fill:rgb(73,100,149);" />
<path d="M703,516L812,542L812,588L703,614Z"  style="fill:rgb(174,192,224);" />
<text x="758" y="270" text-anchor="middle" font-weight="bold" fill="rgb(73,100,149)" font-size="300%" dominant-baseline="central">Windows Firewall</text>
<circle cx="758" cy="182" r="36"  style="fill:none;stroke-width:7.2;stroke:rgb(90,121,166);" />
<path d="M742,182L774,182L758,166L774,182L758,198L774,182"  style="fill:none;stroke-width:7.2;stroke-linejoin:round;stroke:rgb(73,100,149);" />
<path d="M703,1545L812,1545L812,1098L703,1098Z"  style="fill:rgb(73,100,149);" />
<path d="M703,1272L812,1298L812,1344L703,1370Z"  style="fill:rgb(174,192,224);" />
<text x="758" y="1026" text-anchor="middle" font-weight="bold" fill="rgb(73,100,149)" font-size="300%" dominant-baseline="central">Office Firewall</text>
<circle cx="758" cy="938" r="36"  style="fill:none;stroke-width:7.2;stroke:rgb(90,121,166);" />
<path d="M742,938L774,938L758,922L774,938L758,954L774,938"  style="fill:none;stroke-width:7.2;stroke-linejoin:round;stroke:rgb(73,100,149);" />
<path d="M2100,1134L2209,1134L2209,688L2100,688Z"  style="fill:rgb(73,100,149);" />
<path d="M2209,862L2100,888L2100,934L2209,960Z"  style="fill:rgb(174,192,224);" />
<text x="2154" y="555" text-anchor="middle" font-weight="bold" fill="rgb(73,100,149)" font-size="300%" dominant-baseline="central">AWS</text>
<text x="2154" y="616" text-anchor="middle" font-weight="bold" fill="rgb(73,100,149)" font-size="300%" dominant-baseline="central">Security Group</text>
<text x="2154" y="676" text-anchor="middle" font-weight="bold" fill="rgb(73,100,149)" font-size="300%" dominant-baseline="central"></text>
<circle cx="2154" cy="467" r="36"  style="fill:none;stroke-width:7.2;stroke:rgb(90,121,166);" />
<path d="M2170,467L2139,467L2154,483L2139,467L2154,451L2139,467"  style="fill:none;stroke-width:7.2;stroke-linejoin:round;stroke:rgb(73,100,149);" />
<circle cx="369" cy="565" r="7.2" style="fill:rgb(198,88,53);stroke-width:2.16;stroke:rgb(198,88,53);" />
<circle cx="369" cy="1321" r="7.2" style="fill:rgb(198,88,53);stroke-width:2.16;stroke:rgb(198,88,53);" />
<circle cx="2543" cy="911" r="7.2" style="fill:rgb(198,88,53);stroke-width:2.16;stroke:rgb(198,88,53);" />
<path d="M369,565 L 801,565 Q 945,565 1049,665 L 1172,783 Q 1276,882 1346,882 L 1416,882"  style="fill:none;stroke-width:5.76;stroke:rgb(198,88,53);" />
<path d="M1416,882L1394,861L1416,882L1394,904L1416,882"  style="fill:none;stroke-width:5.76;stroke-linejoin:round;stroke:rgb(198,88,53);" />
<path d="M369,1321 L 801,1321 Q 945,1321 1039,1213 L 1182,1049 Q 1276,940 1346,940 L 1416,940"  style="fill:none;stroke-width:5.76;stroke:rgb(198,88,53);" />
<path d="M1416,940L1394,918L1416,940L1394,961L1416,940"  style="fill:none;stroke-width:5.76;stroke-linejoin:round;stroke:rgb(198,88,53);" />
<path d="M2543,911L1568,911"  style="fill:none;stroke-width:5.76;stroke:rgb(198,88,53);" />
<path d="M1568,911L1590,889L1568,911L1590,933L1568,911"  style="fill:none;stroke-width:5.76;stroke-linejoin:round;stroke:rgb(198,88,53);" />
</svg>
</div>
<pre class='hidden'>
topmargin = 1
fontscale = 3
color = 0xc65835 # Orange

define $boxlet {
  oval at -0.18,0 height 0.75 width 0.33 color none fill 0xd6d6d6
  box same as last at -0.12,0.28 height 0.2 width 0.2 radius 0
  box at 0,0 height 1 width 1 color none fill 0x343433 radius 0.2 behind last box
}

define $wall {
  box at 0,0 height 3.1 width 0.76 color none fill 0x496495
  line from -0.38*$1,0.34 to $1*0.38,0.16 to $1*0.38,-0.16 to -0.38*$1,-0.34 close color none fill 0xaec0e0
}

define $wall_info {
  text at last.n + (0.0, 0.5) color 0x496495 $2 bold
  circle at last.n + (0.0,0.3) radius 0.25 thickness 0.05 color 0x5a79a6
  line from (last.x-$1*0.11,last circle.c.y) \
    right $1*0.22 then \
    up $1*0.11 left $1*0.11 then \
    down $1*0.11 right $1*0.11 then \
    down $1*0.11 left $1*0.11 then \
    up $1*0.11 right $1*0.11 \
    color 0x496495 thickness 0.05
}

define $area {
  box at ($1,$2) width $3 height $4 color none fill 0xf9f9f8 radius 0.2
}

# Servers

$area(0.55,0,5.2,3.1)

WS1: [ $boxlet() ] at (0, 0)
text at last.n + (0.0, 0.1) color 0x595857 "VPN Client" above
text at last.s - (0.0, 1) color 0x030303 $2 "Workstation" below

$area(0,-5.25,4.1,3.1)
$area(2.83,-5.25,0.8,3.1)

WS2: [ $boxlet() ] at (0, -5.25)
text at last.n + (0.0, 0.1) color 0x595857 "VPN Client" above
text at last.s - (0.0, 1) color 0x030303 "Workstation" below

$area(8.3,-2.3,6,5.25)

HUB: [ $boxlet() ] at (8.3, -2.4)
text at last.n + (0.0, 0.1) color 0x595857 "VPN Hub"  above
text at last.s - (0.0, 1.78) color 0x030303 "Server" below

$area(16.10,HUB.c.y,4.1,3.1)
$area(13.27,HUB.c.y,0.8,3.1)

WS3: [ $boxlet() ] at (16.10, HUB.c.y)
text at last.n + (0.0, 0.1) color 0x595857 "VPN Client"  above
text at last.s - (0.0, 1) color 0x030303 "EC2 VM" below

[ $wall(1) ] at (3.20,0)
$wall_info(1, "Windows Firewall")

[ $wall(1) ] at (3.2,-5.25)
$wall_info(1, "Office Firewall")

[ $wall(-1) ] at (12.9,HUB.c.y)
$wall_info(-1, "AWS" bold "Security Group" bold "")

dot at WS1.e radius 0.05
dot at WS2.e radius 0.05
dot at WS3.w radius 0.05

line from WS1.e right 4 then down until even with (0,HUB.y+0.2) right 2.3 then right until even with (HUB.w-0.03,0) thickness 0.04 radius 1
line up 0.15 left 0.15 down 0.15 right 0.15 down 0.15 left 0.15 up 0.15 right 0.15 thickness 0.04

line from WS2.e right 4 then up until even with (0,HUB.y-0.2) right 2.3 then right until even with (HUB.w-0.03,0) thickness 0.04 radius 1
line up 0.15 left 0.15 down 0.15 right 0.15 down 0.15 left 0.15 up 0.15 right 0.15 thickness 0.04

line from WS3.w to 0.03 right of HUB.e thickness 0.04
line up 0.15 right 0.15 down 0.15 left 0.15 down 0.15 right 0.15 up 0.15 left 0.15 thickness 0.04
</pre>
</div>
</div>
<p><em>(Click image to see Pikchr source)</em></p>
<script>
  function toggleHidden(id){
    for(var c of document.getElementById(id).children){
      c.classList.toggle('hidden');
    }
  }
</script></article>

        </main><footer id="footer">
    
</footer>
</body>
</html>
